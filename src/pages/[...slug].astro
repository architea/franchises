---
import { useStoryblokApi } from "@storyblok/astro"
import StoryblokComponent from "@storyblok/astro/StoryblokComponent.astro"
import Layout from "../layouts/Layout.astro"
import isPreview from "../utils/isPreview"
import generateStaticPaths from "../utils/generateStaticPaths"

export async function getStaticPaths() {
  //We have moved all the code to a generateStaticPaths() function.
  return await generateStaticPaths()
}

const params = Astro.params
let props = isPreview() ? params?.slug : Astro.props
const { slug } = props

const storyblokApi = useStoryblokApi()
const { data } = await storyblokApi.get("cdn/stories/home", {
  version: isPreview() ? "draft" : "published",
  resolve_relations: "page.canonical"
})

const { story } = data
const seo = {
  title: story.content.title,
  description: story.content.description,
  robots: story.content.robots,
  schema: story.content.schema,
  ogImageUrl: story.content.ogimage.filename,
  ogImageAlt: story.content.ogimage.alt,
  canonical: story.content.canonical.full_slug
}
---

<Layout seo={seo}>
  <StoryblokComponent blok={story.content} />
</Layout>
