---
import isPreview from "../utils/isPreview.js"
import { localizedHTML as favicons } from "astro-favicons/middleware"

//Fetch global info for head
import { useStoryblokApi } from "@storyblok/astro"
const storyblokApi = useStoryblokApi()
const { data } = await storyblokApi.get("cdn/stories/global", {
  version: isPreview() ? "draft" : "published"
})
const themeColor = data.story.content.themeColor
const titleExtension = data.story.content.titleExtension

const { seo } = Astro.props
const canonicalURL =
  seo.canonical?.length > 0
    ? new URL(seo.canonical, Astro.site)
    : new URL(Astro.url.pathname, Astro.site)
---

<head>
  <meta charset="UTF-8" />
  <meta name="theme-color" content={themeColor} />
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1,maximum-scale=5"
  />
  <link rel="canonical" href={canonicalURL} />

  <title>{seo.title}{titleExtension}</title>
  <meta name="description" content={seo.description} />

  <meta name="robots" content={seo.robots} />

  <Fragment set:html={favicons(Astro.currentLocale)} />

  {seo.next && <link rel="next" href={seo.next} />}
  {seo.prev && <link rel="prev" href={seo.prev} />}

  <meta name="og:title" content={seo.title} />
  <meta name="og:description" content={seo.description} />
  <meta property="og:url" content={canonicalURL} />
  <meta property="og:type" content="website" />
  <meta content="ArchitÃ©a" property="og:site_name" />
  <meta property="og:image" content={seo.ogimage} />

  {seo.schema && <script type="application/ld+json" set:html={seo.schema} />}
</head>
